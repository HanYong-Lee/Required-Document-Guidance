<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>업무유형별 구비서류 안내 | KT 매장용</title>
  <style>
    :root{
      --kt-blue:#1f8cff;
      --kt-dark:#111827;
      --kt-gray:#6b7280;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Malgun Gothic,sans-serif;margin:0;background:#f8fafc;color:#0f172a}
    header{background:linear-gradient(90deg,var(--kt-blue),#3b82f6);color:#fff;padding:20px 16px}
    header h1{margin:0 0 6px 0;font-size:20px}
    header p{margin:0;font-size:13px;opacity:.9}
    main{max-width:960px;margin:24px auto;padding:0 16px}
    .card{background:#fff;border-radius:var(--radius);box-shadow:0 6px 24px rgba(2,6,23,.07);padding:16px;margin-bottom:16px}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.row{grid-template-columns:repeat(3,1fr)}}
    label{font-size:12px;color:#334155;margin-bottom:4px;display:block}
    select{width:100%;padding:12px 10px;border:1px solid #e2e8f0;border-radius:12px;font-size:14px;background:#fff}
    select:disabled{background:#f1f5f9;color:#94a3b8}
    .pill{display:inline-block;background:#eef2ff;color:#3730a3;border-radius:999px;padding:4px 10px;font-size:12px;margin:0 6px 6px 0}
    h2{font-size:16px;margin:0 0 8px 0}
    ul{margin:8px 0 0 20px}
    .muted{color:#64748b}
    .grid-2{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.grid-2{grid-template-columns:1fr 1fr}}
    .visitor{border:1px dashed #cbd5e1;border-radius:12px;padding:10px}
    .footer{font-size:12px;color:#64748b;text-align:center;margin:24px 0}
    .btn{appearance:none;border:0;background:var(--kt-blue);color:#fff;border-radius:12px;padding:10px 14px;font-size:14px;cursor:pointer}
    textarea{width:100%;min-height:100px;padding:12px;border:1px solid #e2e8f0;border-radius:12px;resize:vertical;font-size:14px}
    .hint{font-size:12px;color:#64748b;margin-top:6px}
    .banner{display:flex;align-items:center;gap:10px;background:#eff6ff;border:1px solid #bfdbfe;color:#1e40af;padding:10px;border-radius:12px;margin-bottom:12px}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#f1f5f9;border:1px solid #e2e8f0;border-bottom-width:3px;border-radius:6px;padding:0 6px;font-size:12px}
  
    /* Fixed notes list styling */
    .fixed-note{margin:8px 0 0 18px}
    .fixed-note li{margin:4px 0}
    /* Remove bullets for required & visitor lists */
    #required{list-style:none;margin:8px 0 0 0;padding-left:0}
    #required li::marker{content:""}
    #visitor .visitor ul{list-style:none;margin:8px 0 0 0;padding-left:0}
    #visitor .visitor li::marker{content:""}
    /* SMS box */
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap}


    /* Guide panel styling */
    .guide{display:none;background:#f8fafc;border:1px solid #e2e8f0;color:#334155;
      border-radius:10px;padding:10px;margin-top:6px;font-size:13px}
    .li-row{display:flex;align-items:center;gap:8px}
    .btn-info{background:#eef2ff;color:#3730a3;border:1px solid #c7d2fe;padding:2px 8px;border-radius:999px;font-size:12px;cursor:pointer}
    .btn-info:hover{filter:brightness(0.98)}
    .guide h4{margin:0 0 6px 0;font-size:14px}
    .guide .kv{margin:2px 0}

</style>
</head>
<body>
  <header>
    <h1>업무유형별 구비서류 안내</h1>
    <p>KT 매장 직원 전용 · 단계별 드롭다운으로 필요한 서류를 빠르게 확인하세요.</p>
  </header>

  <main>
    <div class="card banner">
      <div><strong>사용법</strong> ① 업무처리 유형 → ② 상세유형1 → ③ 상세유형2 순서로 선택하세요. 선택에 따라 다음 옵션이 자동으로 좁혀집니다.</div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label for="type1">① 업무처리 유형</label>
          <select id="type1"><option value="">선택하세요</option></select>
        </div>
        <div>
          <label for="type2">② 상세유형 1</label>
          <select id="type2" disabled><option value="">먼저 ①을 선택</option></select>
        </div>
        <div>
          <label for="type3">③ 상세유형 2</label>
          <select id="type3" disabled><option value="">먼저 ②를 선택</option></select>
        </div>
      </div>
      <div class="hint">키보드로도 사용 가능: <span class="kbd">Alt</span> + <span class="kbd">↓</span> 로 펼치기</div>
    </div>

    <div id="result" class="card" style="display:none">
      <h2>필수 서류</h2>
      <ul id="required"></ul>

      <h2 style="margin-top:16px">방문자별 추가 서류</h2>
      <div id="visitor" class="grid-2"></div>
    </div>

    
    <div id="sms" class="card" style="display:none">
      <h2>고객 안내 문자 자동완성</h2>
      <textarea id="smsText" class="mono" readonly placeholder="선택한 유형에 따라 자동 생성됩니다."></textarea>
      <div style="margin-top:10px">
        <button class="btn" id="copySms">문구 복사</button>
      </div>
      <div class="hint">내용을 복사해 문자(SMS/MMS)로 붙여넣어 보내세요.</div>
    </div>

    <div class="card">
      <h2>추가 전달사항</h2>
      <ol class="fixed-note">
        <li>제출 서류는 모두 “발급 3개월 이내”만 인정</li>
        <li>열람용 파일이 아닌, “출력해온 발급 서류”만 인정</li>
      </ol>
      <div class="hint">고정 멘트는 코드에서 수정 가능합니다. (index.html 내 고정 텍스트)</div>
    </div>
    <div class="footer">v1 · 데이터 파일: <code>data.json</code> · GitHub Pages에서 그대로 동작</div>
  </main>

  <script>
    const state = {
      data:null,
      selected:{ a:'', b:'', c:'' }
    };

    
    
    async function loadData(){
      const [resData, resGuide] = await Promise.all([
        fetch('data.json',{cache:'no-store'}),
        fetch('docs_guide.json',{cache:'no-store'}).catch(()=>null)
      ]);
      state.data = await resData.json();
      state.guides = await resGuide.json() : {};
      // Build guides index for fuzzy-ish matching
      state.guidesIndex = {};
      const norm = s => (s||'').toString().replace(/\s+/g,'').replace(/[()]/g,'').toLowerCase();
      Object.keys(state.guides||{}).forEach(k=>{ state.guidesIndex[norm(k)] = state.guides[k]; });

      // ① 채우기
      const type1 = document.getElementById('type1');
      state.data.options['업무처리유형'].forEach(v=>{
        const o=document.createElement('option'); o.value=v; o.textContent=v; type1.appendChild(o);
      });
    }



    function fillDetail1(){
      const t1 = document.getElementById('type1').value;
      const type2 = document.getElementById('type2');
      type2.innerHTML = '<option value="">선택하세요</option>';
      const map = state.data.options['상세유형1'][t1] || [];
      map.forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; type2.appendChild(o); });
      type2.disabled = !map.length;
      // reset ③
      const type3 = document.getElementById('type3');
      type3.innerHTML = '<option value="">먼저 ②를 선택</option>';
      type3.disabled = true;
      clearResult();
    }

    function fillDetail2(){
      const t1 = document.getElementById('type1').value;
      const t2 = document.getElementById('type2').value;
      const type3 = document.getElementById('type3');
      type3.innerHTML = '<option value="">선택하세요</option>';
      const key = `${t1}||${t2}`;
      const map = state.data.options['상세유형2'][key] || [];
      map.forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; type3.appendChild(o); });
      type3.disabled = !map.length;
      clearResult();
    }

    function renderResult(){
      const t1 = document.getElementById('type1').value;
      const t2 = document.getElementById('type2').value;
      const t3 = document.getElementById('type3').value;
      if(!t1 || !t2 || !t3){ clearResult(); return; }
      const rec = state.data.records.find(r=> r['업무처리유형']===t1 && r['상세유형1']===t2 && r['상세유형2']===t3 );
      if(!rec){ clearResult(); return; }
      const result = document.getElementById('result');
      const ul = document.getElementById('required'); ul.innerHTML='';
      (rec['필수서류'] || []).forEach((item,idx)=>{
        const li=document.createElement('li');
        const row=document.createElement('div'); row.className='li-row';
        const span=document.createElement('span'); span.className='li-text'; span.textContent=item; row.appendChild(span);
        const btn=document.createElement('button'); btn.className='btn-info'; btn.type='button'; btn.textContent='안내'; row.appendChild(btn);
        li.appendChild(row);
        const g=document.createElement('div'); g.className='guide'; li.appendChild(g);
        ul.appendChild(li);
      });

      const visitorWrap = document.getElementById('visitor'); visitorWrap.innerHTML='';
      const byVisitor = rec['방문자별추가서류'] || {};
      Object.keys(byVisitor).forEach(section=>{
        const box = document.createElement('div'); box.className='visitor';
        const title = document.createElement('div'); title.innerHTML = `<span class="pill">${section}</span>`;
        const l = document.createElement('ul');
        byVisitor[section].forEach(i=>{ const li=document.createElement('li'); li.textContent=i; l.appendChild(li); });
        box.appendChild(title); box.appendChild(l); visitorWrap.appendChild(box);
      });

      result.style.display='block';
      renderSms(rec);
    }

    function clearResult(){
      document.getElementById('result').style.display='none';
      document.getElementById('required').innerHTML='';
      document.getElementById('visitor').innerHTML='';
      renderSms(null);
    }

    
    function uniq(arr){ return [...new Set(arr.filter(Boolean))]; }

    function buildSms(rec){
      const req = Array.isArray(rec['필수서류']) ? rec['필수서류'] : [];
      const byv = rec['방문자별추가서류'] || {};
      const lines = [];
      lines.push('고객님 내방 시 준비 서류:');
      uniq(req).forEach(item=> lines.push(item));
      Object.keys(byv).forEach(section=>{
        const vals = uniq(byv[section] || []);
        if(!vals.length) return;
        lines.push(`[${section}] ` + vals.join(', '));
      });
      lines.push('');
      lines.push('서류가 미비할 경우 재방문이 필요할 수 있습니다.');
      lines.push('감사합니다.');
      return lines.join('
');
    }

    function renderSms(rec){
      const box = document.getElementById('sms');
      const ta  = document.getElementById('smsText');
      if(!rec){ ta.value=''; box.style.display='none'; return; }
      ta.value = buildSms(rec);
      box.style.display='block';
    }

    
    function normDoc(s){ return (s||'').toString().replace(/\s+/g,'').replace(/[()]/g,'').toLowerCase(); }

    function extractDocs(text){
      // split by common joiners: +, /, ·, , 
      const parts = (text||'').split(/[+\/·,]/).map(s=>s.trim()).filter(Boolean);
      return parts.length ? parts : [text];
    }

    function findGuideByName(name){
      const g = state.guidesIndex?.[normDoc(name)];
      return g || null;
    }

    function guideHtml(name, g){
      if(!g) return '';
      const lines = [];
      lines.push(`<h4>${name}</h4>`);
      if(g['요약']) lines.push(`<div class="kv">- 요약: ${g['요약']}</div>`);
      if(g['경로'] && Array.isArray(g['경로'])) lines.push(`<div class="kv">- 경로: ${g['경로'].join(' > ')}</div>`);
      if(g['준비물'] && Array.isArray(g['준비물'])) lines.push(`<div class="kv">- 준비물: ${g['준비물'].join(', ')}</div>`);
      if(g['수수료']) lines.push(`<div class="kv">- 수수료: ${g['수수료']}</div>`);
      if(g['비고']) lines.push(`<div class="kv">- 비고: ${g['비고']}</div>`);
      return lines.join('
');
    }

    function buildGuideFromLine(line){
      const docs = extractDocs(line);
      const blocks = [];
      docs.forEach(d=>{
        const g = findGuideByName(d);
        if(g) blocks.push(guideHtml(d, g));
      });
      if(!blocks.length) return '<em>안내가 아직 없습니다. docs_guide.json에 항목을 추가하세요.</em>';
      return blocks.join('<hr style="border:none;border-top:1px dashed #e2e8f0;margin:8px 0">');
    }

    // wire
    window.addEventListener('DOMContentLoaded', ()=>{
      loadData();
      document.getElementById('type1').addEventListener('change', fillDetail1);
      document.getElementById('type2').addEventListener('change', fillDetail2);
      document.getElementById('type3').addEventListener('change', renderResult);

      // 안내 버튼 토글 (이벤트 위임)
      document.getElementById('result').addEventListener('click', (e)=>{
        if(e.target && e.target.matches('.btn-info')){
          const li = e.target.closest('li');
          const text = li.querySelector('.li-text')?.textContent || '';
          const g = li.querySelector('.guide');
          g.innerHTML = buildGuideFromLine(text);
          g.style.display = (g.style.display==='block') ? 'none' : 'block';
        }
      });
      document.getElementById('copySms').addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(document.getElementById('smsText').value);
          alert('복사되었습니다. 문자 앱에 붙여넣기 하세요.');
        }catch(e){
          alert('복사를 실패했습니다. 텍스트를 직접 선택해 복사하세요.');
        }
      });
});
  </script>
</body>
</html>
